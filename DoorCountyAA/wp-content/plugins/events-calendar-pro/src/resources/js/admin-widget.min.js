!function(e,t){"use strict";var a={},i=e(document.body);a.search_id=function(e){var t=void 0;return void 0!==e.id?t=e.id:void 0!==e.ID?t=e.ID:void 0!==e.value&&(t=e.value),void 0===e?void 0:t},a.calendar_toggle=function(e){e.find(".calendar-widget-filters-title").hide(),e.find(".calendar-widget-filters-operand").hide();var t=e.find(".calendar-widget-added-filters");if(t.length){var a=t.val()?JSON.parse(t.val()):new Object,i=0;for(var n in a)i+=a[n].length;i>0&&(e.find(".calendar-widget-filters-title").show(),i>1&&e.find(".calendar-widget-filters-operand").show())}},a.select2=function(){var i=e(this),n={};if(i.hasClass("select2-container")&&i.select2("destroy"),i.next().hasClass("select2-container")&&i.next().remove(),e("body").hasClass("wp-customizer")&&(n.dropdownCssClass="tribe-customizer-select2"),i.is("select")||(n.id=a.search_id),n.allowClear=!0,i.data("prevent-clear")&&(n.allowClear=!1),i.data("options")&&(n.data=i.data("options")),i.data("hide-search")&&(n.minimumResultsForSearch=1/0),i.is("[multiple]")&&(n.multiple=!0,t.isArray(i.data("separator"))?n.tokenSeparators=i.data("separator"):n.tokenSeparators=[i.data("separator")],n.separator=i.data("separator"),n.regexSeparatorElements=["^("],n.regexSplitElements=["(?:"],e.each(n.tokenSeparators,function(e,t){n.regexSeparatorElements.push("[^"+t+"]+"),n.regexSplitElements.push("["+t+"]")}),n.regexSeparatorElements.push(")$"),n.regexSplitElements.push(")"),n.regexSeparatorString=n.regexSeparatorElements.join(""),n.regexSplitString=n.regexSplitElements.join(""),n.regexToken=new RegExp(n.regexSeparatorString,"ig"),n.regexSplit=new RegExp(n.regexSplitString,"ig")),n.matcher=function(e,a){var i=0==a.toUpperCase().indexOf(e.toUpperCase());if(!i&&void 0!==n.tags){var r=t.where(n.tags,{text:a});if(n.tags.length>0&&t.isObject(r))i=0==obj.search_id(r[0]).toUpperCase().indexOf(e.toUpperCase())}return i},i.data("tags")&&(n.tags=i.data("options"),n.initSelection=function(a,i){var r=[];e(a.val().split(n.regexSplit)).each(function(){var e={id:this,text:this};if(n.tags.length>0&&t.isObject(n.tags[0])){var a=t.where(n.tags,{value:this});a.length>0&&(e={id:(e=a[0]).value,text:e.text})}r.push(e)}),i(r)},n.createSearchChoice=function(e,t){if(e.match(n.regexToken))return{id:e,text:e}},0===n.tags.length&&(n.formatNoMatches=function(){return i.attr("placeholder")})),i.data("source")){var r=i.data("source");n.data={results:[]},n.escapeMarkup=function(e){return e},n.ajax={dataType:"json",type:"POST",url:window.ajaxurl,processResults:function(e){return i.data("lastOptions",e.data),e.data}},n.ajax.data=function(e,t){return{action:"tribe_widget_dropdown_"+r,disabled:i.data("disabled"),selected:i.data("selected"),search:e,page:t}}}i.on("open",function(){e(".select2-drop").css("z-index",1e7)}).trigger("change.select2").select2TEC(n)},a.conditional=function(t,a){var i=e(t),n=i.data("tribeConditionalField"),r=a.find(".js-tribe-conditional").filter('[data-tribe-conditional-field="'+n+'"]'),d=i.val();r.hide().each(function(){var t=e(this);t.hasClass("tribe-select2")&&t.prev(".select2-container").hide()}).filter('[data-tribe-conditional-value="'+d+'"]').show().each(function(){var t=e(this);t.hasClass("tribe-select2")&&t.hide().prev(".select2-container").show()})},a.showFilters=function(e){var t=e.find(".calendar-widget-filters-container"),a=t.find(".calendar-widget-added-filters");a.length&&a.val()&&a.val().length&&null!==a.val()&&"null"!==a.val()&&t.addClass("calendar-widget-filters-container--show")},a.hideFilters=function(e){var t=e.find(".calendar-widget-filters-container"),a=t.find(".calendar-widget-added-filters");if(a.length){var i=a.val();if(i&&i.length)i=JSON.parse(i),Object.keys(i).reduce(function(e,t){return!i[t].length&&null!==i[t].length&&e},!0)&&t.removeClass("calendar-widget-filters-container--show");else t.removeClass("calendar-widget-filters-container--show")}else t.removeClass("calendar-widget-filters-container--show")},a.setup=function(t,i){if(void 0===i){var n=e(t.target);if(!n.parents(".widget-top").length||n.parents("#available-widgets").length)return;(i=n.closest("div.widget")).find("[data-depends]").trigger("setup.dependency").trigger("verify.dependency")}"object"==typeof i&&(i=e(i)),"jQuery"!=typeof i&&(i.is('[id*="tribe-"]')||!i.is(".so-content.panel-dialog")||i.find('[id^="widget-tribe-events-"]'))&&(i.is('[id*="__i__"]')||(i.find(".tribe-widget-select2").each(a.select2).trigger("change.select2"),i.on("change",".js-tribe-condition",function(){a.conditional(this,i)}),a.showFilters(i),e("body").hasClass("wp-customizer")||(e.isNumeric(t)||"widget-updated"===t.type)&&(i.find(".js-tribe-condition").each(function(){a.conditional(this,i)}),i.find("[data-depends]").trigger("setup.dependency").trigger("verify.dependency"))))},e(function(t){e("body").hasClass("wp-customizer")||(a.showFilters,e(".tribe-widget-form").each(a.setup))}),e(document).on({"widget-added widget-updated":function(t,i){var n=e(i);a.setup(t,n),a.showFilters(n),n.find("[data-depends]").trigger("setup.dependency").trigger("verify.dependency")}}).on("change",".calendar-widget-add-filter",function(t){var i,n=e(this),r=n.parents(".tribe-widget-form"),d=r.find(".calendar-widget-filter-list"),s=r.find(".calendar-widget-added-filters"),l=s.val()?JSON.parse(s.val()):{},o=n.val(),c=n.data("disabled")?n.data("disabled"):[],g=n.data("lastOptions");if(void 0!==o&&(null!==l&&"object"==typeof l||(l={}),g.results.forEach(function(e){e.tax&&(l[e.tax.name]||(l[e.tax.name]=[]),e.children.forEach(function(t){t&&t.id==o&&(i=t,l[e.tax.name].push(t.id))}))}),i))if(-1===e.inArray(o.id,l[i.taxonomy.name])||-1===e.inArray(o,l[i.taxonomy.name])){if(!d.find('[data-term="'+i.id+'"]').length){l[i.taxonomy.name].push(o.id),s.val(JSON.stringify(l));var f=e("<a/>").attr({"data-tax":i.taxonomy.name,"data-term":i.id,class:"calendar-widget-remove-filter",href:"#"}).text("(remove)"),p=e("<span/>").append(f),u=e("<li/>").addClass("calendar-widget-filter-item").html(i.taxonomy.labels.name+": "+i.text).append(p);d.append(u),c.push(i.id),n.data("disabled",c),a.showFilters(r),n.val("")}}else n.val("")}).on("click",".calendar-widget-remove-filter",function(i){i.preventDefault();var n=e(this),r=n.parents(".tribe-widget-form"),d=r.find(".calendar-widget-add-filter").not(".select2-container"),s=r.find(".calendar-widget-added-filters"),l=s.val()?JSON.parse(s.val()):{},o=n.data("term"),c=n.data("tax"),g=d.data("disabled")?d.data("disabled"):[];l[c]&&(l[c]=t.without(l[c],o.toString(),null)),s.val(JSON.stringify(l)),d.data("disabled",t.without(g,o.toString())),n.closest("li").remove(),r.find('input[name^="widget-tribe-"]').trigger("change"),a.hideFilters(r)}).on("click",".so-close",function(t){e(".calendar-widget-add-filter").select2("close")}),i.on("click.widgets-toggle",a.setup),e(document).on("panelsopen",function(t){e(".so-content.panel-dialog").each(function(){var i=e(this);if(!i.hasClass("widget")){var n=i.find('[id^="widget-tribe-"]').filter('[id$="-title"]').attr("id");if(!n)return;n=n.substring(0,n.indexOf("-title")),i.attr("id",n).addClass("widget"),a.setup(t,i),e(".so-duplicate").on("click",function(t){e(".calendar-widget-add-filter").select2("close")}),e(".so-delete").on("click",function(t){e(".calendar-widget-add-filter").select2("close")})}})})}(jQuery.noConflict(),_);